// This file is automatically generated. DO NOT EDIT!
// Generated from: codegen/Sources/Schema/Methods/Groups.swift

import Foundation
import SmithereenAPIInternals
import Hammond
extension Groups {

	/// Creates a new group or event on behalf of the current user.
	/// 
	/// - Note: This method requires the following permissions: `groups`.
	public struct Create: SmithereenAPIRequest, Hashable, Encodable, Sendable {

		/// The name of the community.
		public var name: String

		/// The description of the community (HTML).
		public var description: String?

		/// Community type.
		public var type: GroupType

		public enum GroupType: Hashable, Codable, Sendable {
			case group

			/// The associated value is the time when the event starts.
			case event(Date)

			private enum CodingKeys: String, CodingKey {
				case type
				case startDate = "start_date"
			}

			public init(from decoder: Decoder) throws {
				let container = try decoder.container(keyedBy: CodingKeys.self)
				let type = try container.decode(String.self, forKey: .type)
				switch type {
				case "group":
					self = .group
				case "event":
					self = .event(try container.decode(UnixTimestamp<Date>.self, forKey: .startDate).wrappedValue)
				default:
					throw DecodingError.dataCorruptedError(
						forKey: .type,
						in: container,
						debugDescription: "Unknown payload type \(String(reflecting: type))",
					)
				}
			}
			public func encode(to encoder: any Encoder) throws {
				var container = encoder.container(keyedBy: CodingKeys.self)
				let tag: String
				switch self {
				case .group:
					tag = "group"
				case .event(let payload):
					tag = "event"
					try container.encode(UnixTimestamp(wrappedValue: payload), forKey: .startDate)
				}
				try container.encode(tag, forKey: .type)
			}
		}

		/// - parameters:
		///   - name: The name of the community.
		///   - description: The description of the community (HTML).
		///   - type: Community type.
		public init(
			name: String,
			description: String? = nil,
			type: GroupType,
		) {
			self.name = name
			self.description = description
			self.type = type
		}

		private enum CodingKeys: String, CodingKey {
			case name
			case description
		}
		public func encode(to encoder: any Encoder) throws {
			var container = encoder.container(keyedBy: CodingKeys.self)
			try container.encode(self.name, forKey: .name)
			try container.encodeIfPresent(self.description, forKey: .description)
			try self.type.encode(to: encoder)
		}
		public var path: String {
			"/api/method/groups.create"
		}
		public static var method: HTTPMethod {
			.post
		}
		public var encodableBody: Self? {
			self
		}
		public typealias Result = GroupID
	}
}