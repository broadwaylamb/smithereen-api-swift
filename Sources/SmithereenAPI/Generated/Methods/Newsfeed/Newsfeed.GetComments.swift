// This file is automatically generated. DO NOT EDIT!

import Foundation
import SmithereenAPIInternals
import Hammond
extension Newsfeed {

	/// Returns comment threads that the current user has participated in.
	/// 
	/// - Note: This method requires the following permissions: `newsfeed`.
	public struct GetComments: SmithereenAPIRequest, Hashable, Encodable, Sendable {

		/// Which types of commentable objects to return.
		/// 
		/// By default, all types are returned.
		public var filters: Filter?

		public enum Filter: String, Codable, Sendable, CaseIterable {

			/// Wall posts.
			case post

			/// Photos.
			case photo

			/// Discussion board topics.
			case board
		}

		/// Offset into the object list for pagination.
		public var offset: Int?

		/// How many objects to return.
		/// 
		/// Minumum value: 1. Maximum value: 100. By default 25.
		public var count: Int?

		/// How many of the most recent comments to return, from 0 to 3.
		/// 
		/// By default 0.
		public var lastComments: Int?

		/// How to structure the comments for ``lastComments``.
		/// By default uses the user preference.
		public var commentViewType: CommentView?

		/// A list of ``User`` and ``Group`` profile fields to be returned.
		public var fields: [ActorField]?

		public enum CommentableObject: Hashable, Codable, Sendable {
			case post(WallPost)
			case photo(Photo)
			case board(BoardTopic)

			private enum CodingKeys: String, CodingKey {
				case type
				case post
				case photo
				case topic
			}

			public init(from decoder: Decoder) throws {
				let container = try decoder.container(keyedBy: CodingKeys.self)
				let type = try container.decode(String.self, forKey: .type)
				switch type {
				case "post":
					self = .post(try container.decode(WallPost.self, forKey: .post))
				case "photo":
					self = .photo(try container.decode(Photo.self, forKey: .photo))
				case "board":
					self = .board(try container.decode(BoardTopic.self, forKey: .topic))
				default:
					throw DecodingError.dataCorruptedError(
						forKey: .type,
						in: container,
						debugDescription: "Unknown payload type \(String(reflecting: type))",
					)
				}
			}
			public func encode(to encoder: any Encoder) throws {
				var container = encoder.container(keyedBy: CodingKeys.self)
				let tag: String
				switch self {
				case .post(let payload):
					tag = "post"
					try container.encode(payload, forKey: .post)
				case .photo(let payload):
					tag = "photo"
					try container.encode(payload, forKey: .photo)
				case .board(let payload):
					tag = "board"
					try container.encode(payload, forKey: .topic)
				}
				try container.encode(tag, forKey: .type)
			}
		}

		public struct Update: Hashable, Codable, Sendable {
			public var item: CommentableObject

			/// If ``lastComments`` is non-zero, an array of comment
			/// objects.
			public var comments: [WallPost]?

			/// - parameters:
			///   - comments: If ``lastComments`` is non-zero, an array of comment
			///     objects.
			public init(
				item: CommentableObject,
				comments: [WallPost]? = nil,
			) {
				self.item = item
				self.comments = comments
			}

			private enum CodingKeys: String, CodingKey {
				case comments
			}
			public func encode(to encoder: any Encoder) throws {
				var container = encoder.container(keyedBy: CodingKeys.self)
				try self.item.encode(to: encoder)
				try container.encodeIfPresent(self.comments, forKey: .comments)
			}

			public init(from decoder: Decoder) throws {
				let container = try decoder.container(keyedBy: CodingKeys.self)
				self.item = try CommentableObject(from: decoder)
				self.comments = try container.decodeIfPresent([WallPost].self, forKey: .comments)
			}
		}

		public struct Result: Hashable, Codable, Sendable {

			/// The commentable objects themselves.
			public var items: [Update]

			/// User objects relevant to these objects.
			public var profiles: [User]

			/// Group objects relevant to these objects.
			public var groups: [Group]

			/// How many comment threads there are in total.
			public var count: Int

			/// - parameters:
			///   - items: The commentable objects themselves.
			///   - profiles: User objects relevant to these objects.
			///   - groups: Group objects relevant to these objects.
			///   - count: How many comment threads there are in total.
			public init(
				items: [Update],
				profiles: [User],
				groups: [Group],
				count: Int,
			) {
				self.items = items
				self.profiles = profiles
				self.groups = groups
				self.count = count
			}
		}

		/// - parameters:
		///   - filters: Which types of commentable objects to return.
		///     
		///     By default, all types are returned.
		///   - offset: Offset into the object list for pagination.
		///   - count: How many objects to return.
		///     
		///     Minumum value: 1. Maximum value: 100. By default 25.
		///   - lastComments: How many of the most recent comments to return, from 0 to 3.
		///     
		///     By default 0.
		///   - commentViewType: How to structure the comments for ``lastComments``.
		///     By default uses the user preference.
		///   - fields: A list of ``User`` and ``Group`` profile fields to be returned.
		public init(
			filters: Filter? = nil,
			offset: Int? = nil,
			count: Int? = nil,
			lastComments: Int? = nil,
			commentViewType: CommentView? = nil,
			fields: [ActorField]? = nil,
		) {
			self.filters = filters
			self.offset = offset
			self.count = count
			self.lastComments = lastComments
			self.commentViewType = commentViewType
			self.fields = fields
		}

		private enum CodingKeys: String, CodingKey {
			case filters
			case offset
			case count
			case lastComments = "last_comments"
			case commentViewType = "comment_view_type"
			case fields
		}
		public var path: String {
			"/api/method/newsfeed.getComments"
		}
		public static var method: HTTPMethod {
			.post
		}
		public var encodableBody: Self? {
			self
		}
	}
}