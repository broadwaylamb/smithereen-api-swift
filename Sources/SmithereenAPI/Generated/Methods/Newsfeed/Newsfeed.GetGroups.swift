// This file is automatically generated. DO NOT EDIT!
// Generated from: codegen/Sources/Schema/Methods/Newsfeed.swift

import Foundation
import SmithereenAPIInternals
import Hammond
extension Newsfeed {

	/// Returns updates from the current user’s groups.
	/// 
	/// - Note: This method requires the following permissions: `newsfeed`.
	public struct GetGroups: SmithereenAPIRequest, Hashable, Encodable, Sendable {

		public struct PaginationToken: Identifier {
			public var rawValue: String

			public init(rawValue: String) {
				self.rawValue = rawValue
			}
		}

		/// Which types of updates to return.
		/// 
		/// By default, updates of all types are returned.
		public var filters: Filter?

		public enum Filter: String, Codable, Sendable, CaseIterable {

			/// New wall posts.
			case post

			/// New discussion board topics.
			case board

			/// New photos added to albums.
			case photo
		}

		/// An opaque string required for pagination, returned as
		/// ``Result/nextFrom`` by the previous call of this method.
		/// Don’t pass this parameter when loading the news feed for
		/// the first time or refreshing it.
		public var startFrom: PaginationToken?

		/// How many updates to return, from 0 to 100.
		/// 
		/// By default 25.
		public var count: Int?

		/// A list of ``User`` and ``Group`` profile fields to be returned.
		public var fields: [ActorField]?

		public enum UpdatedItem: Hashable, Codable, Sendable {

			/// A new wall post was created.
			case post(WallPostNewsfeedUpdate)

			/// New discussion board topics were created in the group.
			case board([BoardTopic])

			/// New photos were added to the group’s photo albums.
			case photo([PhotoNewsfeedUpdate])

			private enum CodingKeys: String, CodingKey {
				case type
				case post
				case topics
				case photos
			}

			public init(from decoder: Decoder) throws {
				let container = try decoder.container(keyedBy: CodingKeys.self)
				let type = try container.decode(String.self, forKey: .type)
				switch type {
				case "post":
					self = .post(try .init(from: decoder))
				case "board":
					let topics = try container.decode([BoardTopic].self, forKey: .topics)
					self = .board(topics)
				case "photo":
					let photos = try container.decode([PhotoNewsfeedUpdate].self, forKey: .photos)
					self = .photo(photos)
				default:
					throw DecodingError.dataCorruptedError(
						forKey: .type,
						in: container,
						debugDescription: "Unknown payload type \(String(reflecting: type))",
					)
				}
			}
			public func encode(to encoder: any Encoder) throws {
				var container = encoder.container(keyedBy: CodingKeys.self)
				let tag: String
				switch self {
				case .post(let post):
					tag = "post"
					try container.encode(post, forKey: .post)
				case .board(let topics):
					tag = "board"
					try container.encode(topics, forKey: .topics)
				case .photo(let photos):
					tag = "photo"
					try container.encode(photos, forKey: .photos)
				}
				try container.encode(tag, forKey: .type)
			}
		}

		public struct UpdateID: Identifier {
			public var rawValue: Int

			public init(rawValue: Int) {
				self.rawValue = rawValue
			}
		}

		public struct Update: Hashable, Codable, Sendable, Identifiable {
			public var item: UpdatedItem

			/// Identifier of this update.
			public var id: UpdateID

			/// Which group this update is about.
			public var groupID: GroupID

			/// - parameters:
			///   - id: Identifier of this update.
			///   - groupID: Which group this update is about.
			public init(
				item: UpdatedItem,
				id: UpdateID,
				groupID: GroupID,
			) {
				self.item = item
				self.id = id
				self.groupID = groupID
			}

			private enum CodingKeys: String, CodingKey {
				case id
				case groupID = "group_id"
			}
			public func encode(to encoder: any Encoder) throws {
				var container = encoder.container(keyedBy: CodingKeys.self)
				try self.item.encode(to: encoder)
				try container.encode(self.id, forKey: .id)
				try container.encode(self.groupID, forKey: .groupID)
			}

			public init(from decoder: Decoder) throws {
				let container = try decoder.container(keyedBy: CodingKeys.self)
				self.item = try UpdatedItem(from: decoder)
				self.id = try container.decode(UpdateID.self, forKey: .id)
				self.groupID = try container.decode(GroupID.self, forKey: .groupID)
			}
		}

		public struct Result: Hashable, Codable, Sendable {

			/// The updates themselves.
			public var items: [Update]

			/// User objects relevant to these updates.
			public var profiles: [User]

			/// Group objects relevant to these updates.
			public var groups: [Group]

			/// The value to pass as ``startFrom`` in a subsequent call to
			/// this method to load the next page of the news feed.
			/// 
			/// If this field is absent, no more updates are available.
			public var nextFrom: PaginationToken?

			/// - parameters:
			///   - items: The updates themselves.
			///   - profiles: User objects relevant to these updates.
			///   - groups: Group objects relevant to these updates.
			///   - nextFrom: The value to pass as ``startFrom`` in a subsequent call to
			///     this method to load the next page of the news feed.
			///     
			///     If this field is absent, no more updates are available.
			public init(
				items: [Update],
				profiles: [User],
				groups: [Group],
				nextFrom: PaginationToken? = nil,
			) {
				self.items = items
				self.profiles = profiles
				self.groups = groups
				self.nextFrom = nextFrom
			}

			private enum CodingKeys: String, CodingKey {
				case items
				case profiles
				case groups
				case nextFrom = "next_from"
			}
		}

		/// - parameters:
		///   - filters: Which types of updates to return.
		///     
		///     By default, updates of all types are returned.
		///   - startFrom: An opaque string required for pagination, returned as
		///     ``Result/nextFrom`` by the previous call of this method.
		///     Don’t pass this parameter when loading the news feed for
		///     the first time or refreshing it.
		///   - count: How many updates to return, from 0 to 100.
		///     
		///     By default 25.
		///   - fields: A list of ``User`` and ``Group`` profile fields to be returned.
		public init(
			filters: Filter? = nil,
			startFrom: PaginationToken? = nil,
			count: Int? = nil,
			fields: [ActorField]? = nil,
		) {
			self.filters = filters
			self.startFrom = startFrom
			self.count = count
			self.fields = fields
		}

		private enum CodingKeys: String, CodingKey {
			case filters
			case startFrom = "start_from"
			case count
			case fields
		}
		public var path: String {
			"/api/method/newsfeed.getGroups"
		}
		public static var method: HTTPMethod {
			.post
		}
		public var encodableBody: Self? {
			self
		}
	}
}