// This file is automatically generated. DO NOT EDIT!
// Generated from: codegen/Sources/Schema/Objects/AttachmentUpload.swift

import Foundation
import SmithereenAPIInternals

public enum AttachmentToCreate: Hashable, Codable, Sendable {

	public struct Image: Hashable, Codable, Sendable {

		/// The identifier returned by the upload endpoint after
		/// [uploading the image](https://smithereen.software/docs/api/uploads).
		public var fileID: UploadedImageID

		/// The hash returned by the upload endpoint after
		/// [uploading the image](https://smithereen.software/docs/api/uploads).
		public var hash: UploadedImageHash

		/// An optional caption or alt text for this image.
		public var text: String?

		/// - parameters:
		///   - fileID: The identifier returned by the upload endpoint after
		///     [uploading the image](https://smithereen.software/docs/api/uploads).
		///   - hash: The hash returned by the upload endpoint after
		///     [uploading the image](https://smithereen.software/docs/api/uploads).
		///   - text: An optional caption or alt text for this image.
		public init(
			fileID: UploadedImageID,
			hash: UploadedImageHash,
			text: String? = nil,
		) {
			self.fileID = fileID
			self.hash = hash
			self.text = text
		}

		private enum CodingKeys: String, CodingKey {
			case fileID = "file_id"
			case hash
			case text
		}
	}

	/// An image file that is not a photo that belongs to a photo album.
	case image(Image)

	/// A photo from an album.
	case photo(PhotoID)

	/// A poll. The associated value is the identifier of the poll returned by
	/// ``Polls/Create``
	case poll(PollID)

	private enum CodingKeys: String, CodingKey {
		case type
		case image
		case photoID = "photo_id"
		case pollID = "poll_id"
	}

	public init(from decoder: Decoder) throws {
		let container = try decoder.container(keyedBy: CodingKeys.self)
		let type = try container.decode(String.self, forKey: .type)
		switch type {
		case "image":
			self = .image(try .init(from: decoder))
		case "photo":
			let photoID = try container.decode(PhotoID.self, forKey: .photoID)
			self = .photo(photoID)
		case "poll":
			let pollID = try container.decode(PollID.self, forKey: .pollID)
			self = .poll(pollID)
		default:
			throw DecodingError.dataCorruptedError(
				forKey: .type,
				in: container,
				debugDescription: "Unknown payload type \(String(reflecting: type))",
			)
		}
	}
	public func encode(to encoder: any Encoder) throws {
		var container = encoder.container(keyedBy: CodingKeys.self)
		let tag: String
		switch self {
		case .image(let image):
			tag = "image"
			try container.encode(image, forKey: .image)
		case .photo(let photoID):
			tag = "photo"
			try container.encode(photoID, forKey: .photoID)
		case .poll(let pollID):
			tag = "poll"
			try container.encode(pollID, forKey: .pollID)
		}
		try container.encode(tag, forKey: .type)
	}
}